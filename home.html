<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
    <!-- FAVICON -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <meta name="theme-color" content="#1a56db">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MC Store â€” Home</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800;900&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --blue:      #1a56db;
  --blue-dk:   #1347c8;
  --blue-lt:   #eff6ff;
  --blue-mid:  #dbeafe;
  --gold:      #f5a623;
  --gold-lt:   #fef3c7;
  --red:       #ef4444;
  --red-lt:    #fef2f2;
  --white:     #ffffff;
  --gray:      #6b7280;
  --gray-lt:   #f9fafb;
  --text:      #0f172a;
  --border:    #e5e7eb;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'DM Sans', sans-serif;
  background: #f8fafc;
  color: var(--text);
  overflow-x: hidden;
}

.page {
  height: 100vh;
  overflow-y: auto;
  overflow-x: hidden;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/* â”€â”€ TOP HEADER â”€â”€ */
.top-header {
  position: sticky; top: 0; z-index: 100;
  background: var(--white);
  border-bottom: 1px solid var(--border);
  box-shadow: 0 2px 12px rgba(26,86,219,0.06);
  padding: 0 1rem;
}
.header-inner {
  max-width: 1200px; margin: 0 auto;
  height: 56px; display: flex; align-items: center; gap: 0.75rem;
}
.header-logo {
  font-family: 'Playfair Display', serif;
  font-size: 1.3rem; font-weight: 900; color: var(--text); white-space: nowrap;
}
.header-logo span { color: var(--gold); }

.search-bar {
  flex: 1; display: flex; align-items: center;
  background: var(--gray-lt); border: 1.5px solid var(--border);
  border-radius: 12px; padding: 0 0.75rem; gap: 0.5rem; height: 40px;
  transition: all 0.2s;
}
.search-bar:focus-within {
  border-color: var(--blue); background: var(--white);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.08);
}
.search-bar i { color: var(--gray); font-size: 13px; }
.search-bar input {
  border: none; background: none; outline: none;
  font-family: 'DM Sans', sans-serif; font-size: 0.875rem;
  color: var(--text); width: 100%;
}
.search-bar input::placeholder { color: #9ca3af; }

.header-icons { display: flex; align-items: center; gap: 0.25rem; }
.icon-btn {
  width: 38px; height: 38px; border-radius: 10px;
  border: none; background: var(--gray-lt); color: var(--gray);
  font-size: 15px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; position: relative;
}
.icon-btn:hover { background: var(--blue-lt); color: var(--blue); }
.icon-btn .badge {
  position: absolute; top: 4px; right: 4px;
  width: 14px; height: 14px; background: var(--gold);
  border-radius: 50%; font-size: 8px; font-weight: 800;
  color: white; display: flex; align-items: center; justify-content: center;
  border: 1.5px solid white;
}

/* â”€â”€ MAIN â”€â”€ */
.main { max-width: 1200px; margin: 0 auto; padding: 1rem; }

/* â”€â”€ WELCOME â”€â”€ */
.welcome {
  margin-bottom: 1rem;
  animation: fadeUp 0.3s ease both;
}
.welcome p { font-size: 0.78rem; color: var(--gray); }
.welcome h1 {
  font-family: 'Playfair Display', serif;
  font-size: 1.15rem; font-weight: 800; color: var(--text);
}
.welcome h1 span { color: var(--blue); }

/* â”€â”€ HERO BANNER â”€â”€ */
.hero-wrap {
  position: relative;
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 1.25rem;
  touch-action: pan-y;
  user-select: none;
}

.hero-track {
  display: flex;
  height: 190px;
  transition: transform 0.45s cubic-bezier(0.4,0,0.2,1);
  cursor: grab;
}
.hero-track:active { cursor: grabbing; }

@media (min-width: 768px) { .hero-track { height: 270px; } }

.hero-slide {
  min-width: 100%; height: 100%;
  display: flex; align-items: center;
  padding: 1.5rem 2rem;
  position: relative; overflow: hidden;
  flex-shrink: 0;
}

/* 5 different slide gradients */
.slide-1 { background: linear-gradient(135deg, #1a56db 0%, #1e40af 100%); }
.slide-2 { background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 100%); }
.slide-3 { background: linear-gradient(135deg, #b45309 0%, #d97706 100%); }
.slide-4 { background: linear-gradient(135deg, #065f46 0%, #059669 100%); }
.slide-5 { background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); }

.slide-circle-1 {
  position: absolute; right: -20px; top: -20px;
  width: 200px; height: 200px; border-radius: 50%;
  background: rgba(255,255,255,0.08);
}
.slide-circle-2 {
  position: absolute; right: 60px; bottom: -40px;
  width: 140px; height: 140px; border-radius: 50%;
  background: rgba(255,255,255,0.05);
}
.slide-circle-3 {
  position: absolute; left: -30px; top: 50%;
  width: 100px; height: 100px; border-radius: 50%;
  background: rgba(255,255,255,0.04);
}

/* icon art on right side of slide */
.slide-art {
  position: absolute;
  right: 1.5rem; top: 50%;
  transform: translateY(-50%);
  font-size: clamp(3rem, 8vw, 5rem);
  opacity: 0.18;
  color: white;
}

.slide-content { position: relative; z-index: 2; max-width: 65%; }
.slide-tag {
  display: inline-flex; align-items: center; gap: 0.3rem;
  background: rgba(255,255,255,0.18);
  color: white; font-size: 0.68rem; font-weight: 700;
  letter-spacing: 0.06em; text-transform: uppercase;
  padding: 0.22rem 0.6rem; border-radius: 50px;
  margin-bottom: 0.45rem;
  backdrop-filter: blur(10px);
}
.slide-title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.2rem, 4vw, 1.9rem);
  font-weight: 900; color: white; line-height: 1.15;
  margin-bottom: 0.35rem;
  text-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.slide-sub {
  font-size: 0.78rem;
  color: rgba(255,255,255,0.82);
  margin-bottom: 0.8rem;
}
.slide-btn {
  display: inline-flex; align-items: center; gap: 0.4rem;
  background: white; border: none; border-radius: 50px;
  padding: 0.45rem 1rem;
  font-family: 'DM Sans', sans-serif; font-size: 0.75rem; font-weight: 700;
  cursor: pointer; transition: all 0.2s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.slide-btn:hover { transform: scale(1.04); }
.slide-1 .slide-btn { color: #1a56db; }
.slide-2 .slide-btn { color: #0f172a; }
.slide-3 .slide-btn { color: #b45309; }
.slide-4 .slide-btn { color: #065f46; }
.slide-5 .slide-btn { color: #7c3aed; }

/* left/right arrow buttons */


/* dots */
.hero-dots {
  position: absolute;
  bottom: 12px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 6px;
  z-index: 10;
  pointer-events: none;
}
.hero-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: rgba(255,255,255,0.4);
  transition: all 0.35s cubic-bezier(0.4,0,0.2,1);
  border: none;
  flex-shrink: 0;
}
.hero-dot.active {
  width: 22px;
  border-radius: 4px;
  background: white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* â”€â”€ CATEGORIES â”€â”€ */
.section-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 0.75rem;
}
.section-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.05rem; font-weight: 800; color: var(--text);
}
.see-all {
  font-size: 0.76rem; font-weight: 600; color: var(--blue);
  cursor: pointer; display: flex; align-items: center; gap: 3px;
}

.categories {
  display: flex; gap: 0.5rem;
  overflow-x: auto; padding-bottom: 0.5rem;
  margin-bottom: 1.25rem; scrollbar-width: none;
}
.categories::-webkit-scrollbar { display: none; }

.cat-chip {
  display: flex; flex-direction: column; align-items: center;
  gap: 0.3rem; min-width: 62px; cursor: pointer; transition: all 0.2s;
  flex-shrink: 0;
}
.cat-icon {
  width: 50px; height: 50px; border-radius: 15px;
  background: var(--white); border: 1.5px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-size: 18px; color: var(--gray);
  transition: all 0.3s cubic-bezier(0.175,0.885,0.32,1.275);
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.cat-label {
  font-size: 0.65rem; font-weight: 600; color: var(--gray);
  text-align: center; line-height: 1.2;
}
.cat-chip:hover .cat-icon { transform: translateY(-3px); background: var(--blue-lt); color: var(--blue); border-color: var(--blue-mid); }
.cat-chip.active .cat-icon { background: var(--blue); color: white; border-color: var(--blue); box-shadow: 0 6px 16px rgba(26,86,219,0.3); transform: translateY(-3px); }
.cat-chip.active .cat-label { color: var(--blue); font-weight: 700; }

/* â”€â”€ FLASH DEALS â”€â”€ */
.flash-section {
  background: linear-gradient(135deg, #fff7ed, var(--gold-lt));
  border: 1.5px solid #fcd34d; border-radius: 20px;
  padding: 1rem; margin-bottom: 1.25rem;
}
.flash-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 0.85rem;
}
.flash-title-wrap { display: flex; align-items: center; gap: 0.5rem; }
.flash-icon-box {
  width: 30px; height: 30px; background: var(--gold);
  border-radius: 9px; display: flex; align-items: center; justify-content: center;
  color: white; font-size: 14px;
  box-shadow: 0 4px 10px rgba(245,166,35,0.4);
}
.flash-title-wrap h2 {
  font-family: 'Playfair Display', serif;
  font-size: 1rem; font-weight: 800; color: #92400e;
}
.countdown { display: flex; gap: 0.25rem; align-items: center; }
.count-box {
  background: #92400e; color: white; border-radius: 6px;
  padding: 0.18rem 0.38rem; font-size: 0.72rem; font-weight: 800;
  min-width: 24px; text-align: center; font-variant-numeric: tabular-nums;
}
.count-sep { color: #92400e; font-weight: 800; font-size: 0.72rem; }

.flash-scroll {
  display: flex; gap: 0.7rem; overflow-x: auto;
  padding-bottom: 0.25rem; scrollbar-width: none;
}
.flash-scroll::-webkit-scrollbar { display: none; }

/* â”€â”€ PRODUCT GRID â”€â”€ */
.product-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem; margin-bottom: 1.25rem;
}
@media (min-width: 640px)  { .product-grid { grid-template-columns: repeat(3,1fr); } }
@media (min-width: 1024px) { .product-grid { grid-template-columns: repeat(4,1fr); } }

/* â”€â”€ PRODUCT CARD â”€â”€ */
.product-card {
  background: var(--white); border-radius: 16px;
  overflow: hidden; border: 1.5px solid var(--border);
  cursor: pointer; position: relative;
  transition: all 0.3s cubic-bezier(0.175,0.885,0.32,1.275);
  animation: fadeUp 0.4s ease both;
}
.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 28px rgba(26,86,219,0.12);
  border-color: var(--blue-mid);
}
@keyframes fadeUp {
  from { opacity:0; transform:translateY(14px); }
  to   { opacity:1; transform:translateY(0); }
}

.flash-card {
  min-width: 138px; flex-shrink: 0;
  background: var(--white); border-radius: 14px;
  overflow: hidden; border: 1.5px solid #fde68a;
  cursor: pointer; transition: all 0.25s;
}
.flash-card:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(245,166,35,0.2); }

.card-img-wrap {
  width: 100%; aspect-ratio: 1;
  background: var(--gray-lt); position: relative; overflow: hidden;
}
.flash-card .card-img-wrap { height: 118px; aspect-ratio: unset; }

.card-img-wrap img {
  width: 100%; height: 100%; object-fit: cover;
  transition: transform 0.4s ease;
}
.product-card:hover .card-img-wrap img { transform: scale(1.06); }

.card-img-placeholder {
  width: 100%; height: 100%;
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem; color: var(--blue);
  background: linear-gradient(135deg, var(--blue-lt), var(--blue-mid));
}

.discount-badge {
  position: absolute; top: 8px; left: 8px;
  background: var(--red); color: white;
  font-size: 0.63rem; font-weight: 800;
  padding: 0.18rem 0.38rem; border-radius: 6px;
}

.wishlist-btn {
  position: absolute; top: 7px; right: 7px;
  width: 27px; height: 27px; border-radius: 50%;
  background: white; border: none;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; color: #9ca3af; cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: all 0.2s;
}
.wishlist-btn:hover { color: var(--red); }
.wishlist-btn.active { color: var(--red); background: var(--red-lt); }

.card-body { padding: 0.6rem 0.7rem 0.7rem; }
.card-name {
  font-size: 0.78rem; font-weight: 600; color: var(--text);
  line-height: 1.35; margin-bottom: 0.28rem;
  display: -webkit-box; -webkit-line-clamp: 2;
  -webkit-box-orient: vertical; overflow: hidden;
}
.card-prices {
  display: flex; align-items: center; gap: 0.35rem;
  margin-bottom: 0.4rem; flex-wrap: wrap;
}
.card-price { font-size: 0.92rem; font-weight: 800; color: var(--blue); }
.card-original { font-size: 0.7rem; color: #9ca3af; text-decoration: line-through; }
.card-rating {
  display: flex; align-items: center; gap: 0.2rem;
  font-size: 0.7rem; color: var(--gray); margin-bottom: 0.45rem;
}
.card-rating i { color: var(--gold); font-size: 10px; }
.stars-row { color: var(--gold); font-size: 11px; letter-spacing: 1px; }
.rating-num { font-weight: 700; color: var(--dark); }
.rating-cnt { color: var(--gray); }

.add-cart-btn {
  width: 100%; background: var(--blue); color: white;
  border: none; border-radius: 8px; padding: 0.42rem;
  font-family: 'DM Sans', sans-serif; font-size: 0.73rem; font-weight: 700;
  cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.3rem;
  transition: all 0.2s;
}
.add-cart-btn:hover { background: var(--blue-dk); }
.add-cart-btn.adding { background: #16a34a; pointer-events: none; }

/* Flash card tweaks */
.flash-card .card-body { padding: 0.45rem 0.55rem 0.55rem; }
.flash-card .card-name { font-size: 0.73rem; -webkit-line-clamp: 1; }
.flash-card .card-price { font-size: 0.82rem; }

/* â”€â”€ SKELETON â”€â”€ */
.skeleton {
  background: linear-gradient(90deg,#f0f0f0 25%,#e8e8e8 50%,#f0f0f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
}
@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
.skeleton-card {
  background: white; border-radius: 16px; overflow: hidden;
  border: 1.5px solid var(--border);
}
.skeleton-img { aspect-ratio: 1; width: 100%; }
.skeleton-body { padding: 0.6rem 0.7rem; }
.skeleton-line { height: 11px; margin-bottom: 7px; }
.skeleton-line.w80 { width: 80%; }
.skeleton-line.w50 { width: 50%; }
.skeleton-line.w90 { width: 90%; }

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty-state {
  grid-column: 1/-1; text-align: center;
  padding: 2.5rem 1rem; color: var(--gray);
}
.empty-state i { font-size: 2.5rem; margin-bottom: 0.6rem; color: var(--blue-mid); display: block; }
.empty-state h3 { font-size: 0.95rem; font-weight: 700; color: var(--text); margin-bottom: 0.2rem; }
.empty-state p { font-size: 0.82rem; }

/* â”€â”€ TOAST â”€â”€ */
.toast {
  position: fixed; bottom: 88px; left: 50%;
  transform: translateX(-50%) translateY(16px);
  background: #0f172a; color: white;
  padding: 0.6rem 1.2rem; border-radius: 50px;
  font-size: 0.8rem; font-weight: 600;
  z-index: 9999; opacity: 0; transition: all 0.3s ease;
  white-space: nowrap; display: flex; align-items: center; gap: 0.45rem;
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  pointer-events: none;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.toast.success i { color: #4ade80; }
.toast.error i { color: #f87171; }

.pb-nav { padding-bottom: 1.5rem; }
</style>
</head>
<body>

<div class="page" id="homePage">

  <!-- TOP HEADER -->
  <header class="top-header">
    <div class="header-inner">
      <div class="header-logo">MC<span>Store</span></div>
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search products, brands...">
      </div>
      <div class="header-icons">
        <button class="icon-btn" id="notifBtn">
          <i class="fas fa-bell"></i>
        </button>
        <button class="icon-btn" id="cartBtn">
          <i class="fas fa-cart-shopping"></i>
          <span class="badge" id="cartBadge" style="display:none">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="main">

    <!-- WELCOME -->
    <div class="welcome">
      <p>Good day <i class="fas fa-hand-wave" style="color:var(--gold)"></i></p>
      <h1>Welcome back, <span id="userName">...</span></h1>
    </div>

    <!-- â•â• HERO BANNER â•â• -->
    <div class="hero-wrap" id="heroWrap">

      <div class="hero-track" id="heroTrack">

        <!-- SLIDE 1 -->
        <div class="hero-slide slide-1">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-mobile-screen"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-fire"></i> Hot Deal</div>
            <div class="slide-title">Up to 50% Off<br>Electronics</div>
            <div class="slide-sub">Limited time â€” shop now!</div>
            <button class="slide-btn" onclick="filterCategory('Electronics & Gadgets')">
              Shop Now <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- SLIDE 2 -->
        <div class="hero-slide slide-2">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-shirt"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-star"></i> New Arrivals</div>
            <div class="slide-title">Fresh Fashion<br>Just Landed</div>
            <div class="slide-sub">Latest styles for every occasion</div>
            <button class="slide-btn" onclick="filterCategory('Fashion & Clothing')">
              Explore <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- SLIDE 3 -->
        <div class="hero-slide slide-3">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-truck-fast"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-truck"></i> Free Delivery</div>
            <div class="slide-title">Free Shipping<br>Above â‚¦10,000</div>
            <div class="slide-sub">Shop more, save more!</div>
            <button class="slide-btn" onclick="filterCategory(null)">
              Shop All <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- SLIDE 4 -->
        <div class="hero-slide slide-4">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-basket-shopping"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-leaf"></i> Groceries</div>
            <div class="slide-title">Fresh Food &<br>Groceries Daily</div>
            <div class="slide-sub">Quality products delivered to you</div>
            <button class="slide-btn" onclick="filterCategory('Food & Groceries')">
              Order Now <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- SLIDE 5 -->
        <div class="hero-slide slide-5">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-gem"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-crown"></i> Premium</div>
            <div class="slide-title">Beauty & Health<br>Essentials</div>
            <div class="slide-sub">Top brands at unbeatable prices</div>
            <button class="slide-btn" onclick="filterCategory('Beauty & Health')">
              Discover <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

      </div>

      <!-- Dots -->
      <div class="hero-dots" id="heroDots"></div>
    </div>

    <!-- â•â• CATEGORIES â•â• -->
    <div style="margin-bottom:1.25rem">
      <div class="section-header">
        <div class="section-title">Categories</div>
        <div class="see-all" onclick="filterCategory(null)">All <i class="fas fa-chevron-right"></i></div>
      </div>
      <div class="categories" id="catList">
        <div class="cat-chip active" data-cat="all" onclick="filterCategory(null)">
          <div class="cat-icon"><i class="fas fa-store"></i></div>
          <div class="cat-label">All</div>
        </div>
        <div class="cat-chip" data-cat="Electronics" onclick="filterCategory('Electronics')">
          <div class="cat-icon"><i class="fas fa-desktop"></i></div>
          <div class="cat-label">Electronics</div>
        </div>
        <div class="cat-chip" data-cat="Mobile Phones" onclick="filterCategory('Mobile Phones')">
          <div class="cat-icon"><i class="fas fa-mobile-screen"></i></div>
          <div class="cat-label">Phones</div>
        </div>
        <div class="cat-chip" data-cat="Phone Accessories" onclick="filterCategory('Phone Accessories')">
          <div class="cat-icon"><i class="fas fa-headphones"></i></div>
          <div class="cat-label">Accessories</div>
        </div>
        <div class="cat-chip" data-cat="Laptops or accessories" onclick="filterCategory('Laptops or accessories')">
          <div class="cat-icon"><i class="fas fa-laptop"></i></div>
          <div class="cat-label">Laptops</div>
        </div>
        <div class="cat-chip" data-cat="Tablets" onclick="filterCategory('Tablets')">
          <div class="cat-icon"><i class="fas fa-tablet-screen-button"></i></div>
          <div class="cat-label">Tablets</div>
        </div>
        <div class="cat-chip" data-cat="Cameras" onclick="filterCategory('Cameras')">
          <div class="cat-icon"><i class="fas fa-camera"></i></div>
          <div class="cat-label">Cameras</div>
        </div>
        <div class="cat-chip" data-cat="Home Appliances" onclick="filterCategory('Home Appliances')">
          <div class="cat-icon"><i class="fas fa-house"></i></div>
          <div class="cat-label">Home</div>
        </div>
        <div class="cat-chip" data-cat="Fashion" onclick="filterCategory('Fashion')">
          <div class="cat-icon"><i class="fas fa-shirt"></i></div>
          <div class="cat-label">Fashion</div>
        </div>
        <div class="cat-chip" data-cat="Shoes" onclick="filterCategory('Shoes')">
          <div class="cat-icon"><i class="fas fa-shoe-prints"></i></div>
          <div class="cat-label">Shoes</div>
        </div>
        <div class="cat-chip" data-cat="Bags & Accessories" onclick="filterCategory('Bags & Accessories')">
          <div class="cat-icon"><i class="fas fa-bag-shopping"></i></div>
          <div class="cat-label">Bags</div>
        </div>
        <div class="cat-chip" data-cat="Sports & Outdoors" onclick="filterCategory('Sports & Outdoors')">
          <div class="cat-icon"><i class="fas fa-dumbbell"></i></div>
          <div class="cat-label">Sports</div>
        </div>
        <div class="cat-chip" data-cat="Toys & Games" onclick="filterCategory('Toys & Games')">
          <div class="cat-icon"><i class="fas fa-gamepad"></i></div>
          <div class="cat-label">Toys</div>
        </div>
        <div class="cat-chip" data-cat="Books & Stationery" onclick="filterCategory('Books & Stationery')">
          <div class="cat-icon"><i class="fas fa-book-open"></i></div>
          <div class="cat-label">Books</div>
        </div>
        <div class="cat-chip" data-cat="Cars & Vehicles" onclick="filterCategory('Cars & Vehicles')">
          <div class="cat-icon"><i class="fas fa-car"></i></div>
          <div class="cat-label">Cars</div>
        </div>
        <div class="cat-chip" data-cat="Others" onclick="filterCategory('Others')">
          <div class="cat-icon"><i class="fas fa-box"></i></div>
          <div class="cat-label">Others</div>
        </div>
      </div>
    </div>

    <!-- â•â• FEATURED PRODUCTS (right after banner) â•â• -->
    <div style="margin-bottom:1.25rem">
      <div class="section-header">
        <div class="section-title" id="featuredTitle">Featured Products</div>
        <div class="see-all" onclick="filterCategory(null)">See all <i class="fas fa-chevron-right"></i></div>
      </div>
      <div class="product-grid" id="featuredGrid">
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
      </div>
    </div>

    <!-- â•â• FLASH DEALS â•â• -->
    <div class="flash-section" id="flashSection" style="margin-bottom:1.25rem">
      <div class="flash-header">
        <div class="flash-title-wrap">
          <div class="flash-icon-box"><i class="fas fa-bolt"></i></div>
          <h2>Flash Deals</h2>
        </div>
        <div class="countdown">
          <div class="count-box" id="countH">06</div>
          <div class="count-sep">:</div>
          <div class="count-box" id="countM">00</div>
          <div class="count-sep">:</div>
          <div class="count-box" id="countS">00</div>
        </div>
      </div>
      <div class="flash-scroll" id="flashGrid">
        <div class="flash-card" style="min-width:138px"><div class="skeleton" style="height:118px;width:100%"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="flash-card" style="min-width:138px"><div class="skeleton" style="height:118px;width:100%"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="flash-card" style="min-width:138px"><div class="skeleton" style="height:118px;width:100%"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
      </div>
    </div>

    <!-- â•â• NEW ARRIVALS â•â• -->
    <div style="margin-bottom:1.25rem">
      <div class="section-header">
        <div class="section-title">New Arrivals</div>
        <div class="see-all" onclick="filterCategory(null)">See all <i class="fas fa-chevron-right"></i></div>
      </div>
      <div class="product-grid" id="newArrivalsGrid">
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
      </div>
    </div>

    <!-- â•â• TOP PICKS â•â• -->
    <div style="margin-bottom:1.25rem" id="topPicksSection">
      <div class="section-header">
        <div class="section-title">ðŸ”¥ Top Picks</div>
        <div class="see-all" onclick="filterCategory(null)">See all <i class="fas fa-chevron-right"></i></div>
      </div>
      <div class="product-grid" id="topPicksGrid">
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
      </div>
    </div>

    <div class="pb-nav"></div>
  </main>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <i class="fas fa-check-circle"></i>
  <span id="toastMsg"></span>
</div>

<script type="module">
import { getSession } from './session.js';
import {
  getProducts, getFeaturedProducts,
  getWishlist,
  addToCart, addToWishlist, removeFromWishlist,
  getCartCount, getWishlistCount, normaliseId, formatPrice
} from './product.js';

// â”€â”€ STATE â”€â”€
let currentUser   = null;
let allProducts   = [];
let wishlistSet   = new Set();
let heroIndex     = 0;
let heroTotal     = 5;
let heroTimer     = null;
let isDragging    = false;
let dragStartX    = 0;

// â”€â”€ INIT â”€â”€
async function init() {
  // â”€â”€ Start products loading IMMEDIATELY â€” don't wait for session â”€â”€
  buildHeroDots();
  startHero();
  startCountdown();

  // Load products right away
  const productsPromise = Promise.all([
    loadFeatured(),
    loadNewArrivals(),
    loadFlashDeals(),
    loadTopPicks()
  ]);

  // Load session in background â€” won't block products
  getSession().then(async session => {
    if (session) {
      currentUser = session;
      const uid = session.uid || session.id || '';
      const firstName = (session.fullName || session.displayName || session.email || 'Customer');
      const name = firstName.split(' ')[0].split('@')[0];
      document.getElementById('userName').textContent = name;
      // Load cart count
      getCartCount(uid).then(count => updateCartBadge(count)).catch(() => {});
      // Load wishlist so hearts highlight correctly
      getWishlist(uid).then(items => {
        if (items && items.length > 0) {
          // Always store as String so .has() works regardless of DB type (UUID/int)
          items.forEach(item => wishlistSet.add(String(item.product_id)));
          // Re-render hearts on all visible cards
          document.querySelectorAll('[data-wish-id]').forEach(btn => {
            const pid = String(btn.dataset.wishId);
            if (wishlistSet.has(pid)) {
              btn.classList.add('active');
              const icon = btn.querySelector('i');
              if (icon) icon.className = 'fas fa-heart';
            }
          });
        }
        // Update wishlist badge
        getWishlistCount(uid).then(cnt => {
          window.parent.postMessage({ type: 'wishlistUpdate', count: cnt }, '*');
        }).catch(() => {});
      }).catch(() => {});
    } else {
      document.getElementById('userName').textContent = 'Guest';
    }
  }).catch(() => {
    document.getElementById('userName').textContent = 'Guest';
  });

  await productsPromise;
}

// â”€â”€ HERO DOTS â”€â”€
function buildHeroDots() {
  const wrap = document.getElementById('heroDots');
  wrap.innerHTML = Array.from({length: heroTotal}, (_, i) =>
    `<button class="hero-dot ${i===0?'active':''}" onclick="goToSlide(${i})"></button>`
  ).join('');
}

// â”€â”€ HERO GO TO SLIDE â”€â”€
window.goToSlide = function(index) {
  heroIndex = (index + heroTotal) % heroTotal;
  document.getElementById('heroTrack').style.transform = `translateX(-${heroIndex * 100}%)`;
  document.querySelectorAll('.hero-dot').forEach((d, i) =>
    d.classList.toggle('active', i === heroIndex)
  );
};

// â”€â”€ AUTO SLIDESHOW â”€â”€
function startHero() {
  heroTimer = setInterval(() => goToSlide(heroIndex + 1), 3000);
}
function resetHeroTimer() {
  clearInterval(heroTimer);
  startHero();
}

// â”€â”€ ARROW BUTTONS â”€â”€
// â”€â”€ SWIPE / DRAG on hero â”€â”€
const heroWrap = document.getElementById('heroWrap');

heroWrap.addEventListener('mousedown', e => { isDragging = true; dragStartX = e.clientX; });
heroWrap.addEventListener('mousemove', e => { if (isDragging) e.preventDefault(); });
heroWrap.addEventListener('mouseup', e => {
  if (!isDragging) return;
  isDragging = false;
  const diff = dragStartX - e.clientX;
  if (Math.abs(diff) > 40) { goToSlide(diff > 0 ? heroIndex + 1 : heroIndex - 1); resetHeroTimer(); }
});
heroWrap.addEventListener('mouseleave', () => { isDragging = false; });

heroWrap.addEventListener('touchstart', e => { dragStartX = e.touches[0].clientX; }, {passive:true});
heroWrap.addEventListener('touchend', e => {
  const diff = dragStartX - e.changedTouches[0].clientX;
  if (Math.abs(diff) > 40) { goToSlide(diff > 0 ? heroIndex + 1 : heroIndex - 1); resetHeroTimer(); }
});

// â”€â”€ COUNTDOWN (6 hours) â”€â”€
function startCountdown() {
  let total = 6 * 3600;
  const tick = () => {
    document.getElementById('countH').textContent = String(Math.floor(total/3600)).padStart(2,'0');
    document.getElementById('countM').textContent = String(Math.floor((total%3600)/60)).padStart(2,'0');
    document.getElementById('countS').textContent = String(total%60).padStart(2,'0');
    if (total > 0) total--;
  };
  tick();
  setInterval(tick, 1000);
}

// â”€â”€ TIMEOUT HELPER â€” never load forever â”€â”€
function withTimeout(promise, ms = 8000) {
  return Promise.race([
    promise,
    new Promise((_, reject) => setTimeout(() => reject(new Error('timeout')), ms))
  ]);
}

// â”€â”€ LOAD FEATURED â”€â”€
async function loadFeatured() {
  try {
    const all = await withTimeout(getProducts({ limit: 50 }));
    const priority = all.filter(p => p.section === 'Featured Products');
    const rest     = all.filter(p => p.section !== 'Featured Products');
    const products = [...priority, ...rest];
    allProducts = [...allProducts, ...products];
    if (products.length === 0) { renderEmpty('featuredGrid', 'No products yet'); return; }
    renderGrid('featuredGrid', products);
  } catch(e) {
    renderEmpty('featuredGrid', 'No products yet');
  }
}

// â”€â”€ LOAD NEW ARRIVALS â”€â”€
async function loadNewArrivals() {
  try {
    const all = await withTimeout(getProducts({ limit: 50 }));
    const priority = all.filter(p => p.section === 'New Arrivals');
    const rest     = all.filter(p => p.section !== 'New Arrivals');
    const products = [...priority, ...rest];
    allProducts = [...new Map([...allProducts, ...products].map(p => [p.id, p])).values()];
    if (products.length === 0) { renderEmpty('newArrivalsGrid', 'No products yet'); return; }
    renderGrid('newArrivalsGrid', products);
  } catch(e) {
    renderEmpty('newArrivalsGrid', 'No products yet');
  }
}

// â”€â”€ LOAD FLASH DEALS â”€â”€
async function loadFlashDeals() {
  try {
    const all = await withTimeout(getProducts({ limit: 100 }));
    const sectionDeals  = all.filter(p => p.section === 'Flash Deals');
    const discountDeals = all.filter(p => p.discount > 0 && p.section !== 'Flash Deals');
    const deals = [...sectionDeals, ...discountDeals].slice(0, 20);
    if (deals.length === 0) { document.getElementById('flashSection').style.display = 'none'; return; }
    document.getElementById('flashSection').style.display = 'block';
    renderFlash(deals);
  } catch(e) {
    document.getElementById('flashSection').style.display = 'none';
  }
}

// â”€â”€ LOAD TOP PICKS â”€â”€
async function loadTopPicks() {
  try {
    const all = await withTimeout(getProducts({ limit: 50 }));
    const priority = all.filter(p => p.section === 'Top Picks');
    const rest     = all.filter(p => p.section !== 'Top Picks').sort(() => Math.random() - 0.5);
    const products = [...priority, ...rest];
    if (products.length === 0) { document.getElementById('topPicksSection').style.display = 'none'; return; }
    renderGrid('topPicksGrid', products);
  } catch(e) {
    document.getElementById('topPicksSection').style.display = 'none';
  }
}

// â”€â”€ RENDER GRID â”€â”€
function renderGrid(gridId, products) {
  const grid = document.getElementById(gridId);
  if (!products || products.length === 0) { renderEmpty(gridId, 'No products yet'); return; }
  grid.innerHTML = products.map((p, i) => productCardHTML(p, i)).join('');
}

// â”€â”€ RENDER FLASH â”€â”€
function renderFlash(products) {
  document.getElementById('flashGrid').innerHTML =
    products.map((p, i) => flashCardHTML(p, i)).join('');
}

// â”€â”€ RENDER EMPTY â”€â”€
function renderEmpty(gridId, msg) {
  document.getElementById(gridId).innerHTML = `
    <div class="empty-state">
      <i class="fas fa-box-open"></i>
      <h3>Coming Soon</h3>
      <p>${msg}</p>
    </div>`;
}

// â”€â”€ PRODUCT CARD HTML â”€â”€
function productCardHTML(p, i) {
  // display_price = what customer pays; original_price = crossed-out if promo active
  const sellPrice = p.display_price || p.price;
  const origPrice = p.original_price;
  const price     = formatPrice(sellPrice);
  const original  = origPrice && origPrice > sellPrice ? formatPrice(origPrice) : '';
  const discPct   = origPrice && origPrice > sellPrice
    ? Math.round((1 - sellPrice / origPrice) * 100)
    : (p.discount > 0 ? p.discount : 0);
  const rating   = p.rating ? Number(p.rating).toFixed(1) : '5.0';
  const inWish   = wishlistSet.has(String(p.id));
  const delay    = `animation-delay:${i * 0.055}s`;
  const catIcon  = categoryIcon(p.category);

  const imgHTML = p.image_url
    ? `<img src="${p.image_url}" alt="${p.name}" loading="lazy"
         onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">`
    : '';

  return `
  <div class="product-card" style="${delay}" onclick="openProduct('${p.id}')">
    <div class="card-img-wrap">
      ${imgHTML}
      <div class="card-img-placeholder" style="${p.image_url?'display:none':''}">
        <i class="${catIcon}" style="font-size:2.2rem"></i>
      </div>
      ${discPct > 0 ? `<div class="discount-badge">-${discPct}%</div>` : ''}
      <button class="wishlist-btn ${inWish?'active':''}" data-wish-id="${p.id}"
        onclick="event.stopPropagation();toggleWish(this,'${p.id}')">
        <i class="fa${inWish?'s':'r'} fa-heart"></i>
      </button>
    </div>
    <div class="card-body">
      <div class="card-name">${p.name}</div>
      <div class="card-prices">
        <span class="card-price">${price}</span>
        ${original ? `<span class="card-original">${original}</span>` : ''}
      </div>
      <div class="card-rating">
        <span class="stars-row">${'â˜…'.repeat(Math.round(Number(p.rating)||5))}${'â˜†'.repeat(5-Math.round(Number(p.rating)||5))}</span>
        <span class="rating-num">${rating}</span>
        ${p.review_count ? `<span class="rating-cnt">(${p.review_count})</span>` : ''}
      </div>
      <button class="add-cart-btn" onclick="event.stopPropagation();handleAddCart(this,'${p.id}')">
        <i class="fas fa-cart-plus"></i> Add to Cart
      </button>
    </div>
  </div>`;
}

// â”€â”€ FLASH CARD HTML â”€â”€
function flashCardHTML(p, i) {
  const sellPrice = p.display_price || p.price;
  const origPrice = p.original_price;
  const price     = formatPrice(sellPrice);
  const original  = origPrice && origPrice > sellPrice ? formatPrice(origPrice) : '';
  const catIcon  = categoryIcon(p.category);
  const imgHTML  = p.image_url
    ? `<img src="${p.image_url}" alt="${p.name}" loading="lazy">`
    : `<div class="card-img-placeholder"><i class="${catIcon}" style="font-size:2rem"></i></div>`;

  return `
  <div class="flash-card" onclick="openProduct('${p.id}')">
    <div class="card-img-wrap">
      ${imgHTML}
      ${(origPrice && origPrice > sellPrice) ? `<div class="discount-badge">-${Math.round((1-sellPrice/origPrice)*100)}%</div>` : (p.discount>0?`<div class="discount-badge">-${p.discount}%</div>`:'')}
    </div>
    <div class="card-body">
      <div class="card-name">${p.name}</div>
      <div class="card-prices">
        <span class="card-price">${price}</span>
        ${original?`<span class="card-original">${original}</span>`:''}
      </div>
    </div>
  </div>`;
}

// â”€â”€ CATEGORY ICON â”€â”€
function categoryIcon(cat) {
  const map = {
    'Electronics':            'fas fa-desktop',
    'Mobile Phones':          'fas fa-mobile-screen',
    'Phone Accessories':      'fas fa-headphones',
    'Laptops or accessories': 'fas fa-laptop',
    'Tablets':                'fas fa-tablet-screen-button',
    'Cameras':                'fas fa-camera',
    'Home Appliances':        'fas fa-house',
    'Fashion':                'fas fa-shirt',
    'Shoes':                  'fas fa-shoe-prints',
    'Bags & Accessories':     'fas fa-bag-shopping',
    'Sports & Outdoors':      'fas fa-dumbbell',
    'Toys & Games':           'fas fa-gamepad',
    'Books & Stationery':     'fas fa-book-open',
    'Cars & Vehicles':        'fas fa-car',
    'Others':                 'fas fa-box',
  };
  return map[cat] || 'fas fa-tag';
}

// â”€â”€ FILTER BY CATEGORY â”€â”€
window.filterCategory = async function(cat) {
  // update chips
  document.querySelectorAll('.cat-chip').forEach(chip => {
    chip.classList.toggle('active',
      (!cat && chip.dataset.cat === 'all') || chip.dataset.cat === cat
    );
  });

  document.getElementById('featuredTitle').textContent = cat || 'All Products';

  // skeleton
  document.getElementById('featuredGrid').innerHTML = Array(4).fill(`
    <div class="skeleton-card">
      <div class="skeleton skeleton-img"></div>
      <div class="skeleton-body">
        <div class="skeleton skeleton-line w90"></div>
        <div class="skeleton skeleton-line w50"></div>
      </div>
    </div>`).join('');

  try {
    const products = cat ? await getProducts({ category: cat }) : await getFeaturedProducts(50);
    renderGrid('featuredGrid', products);
  } catch(e) {
    renderEmpty('featuredGrid', 'Could not load products.');
  }
};

// â”€â”€ ADD TO CART â”€â”€
window.handleAddCart = async function(btn, productId) {
  if (!currentUser) {
    showToast('Please log in first', 'error');
    setTimeout(() => { window.parent.postMessage({ type: 'switchTab', target: 'account' }, '*'); }, 1200);
    return;
  }

  btn.disabled = true;
  btn.classList.add('adding');
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Addingâ€¦';

  try {
    const uid = currentUser.uid || currentUser.id;
    const product = allProducts.find(p => String(p.id) === String(productId));
    if (!product) throw new Error('Product not found');
    await addToCart(uid, product);
    const count = await getCartCount(uid);
    updateCartBadge(count);
    window.parent.postMessage({ type: 'cartUpdate', count }, '*');
    btn.innerHTML = '<i class="fas fa-check"></i> Added!';
    showToast('Added to cart! ðŸ›’', 'success');
  } catch(e) {
    showToast('Could not add to cart', 'error');
    btn.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart';
  }

  setTimeout(() => {
    btn.disabled = false;
    btn.classList.remove('adding');
    btn.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart';
  }, 2200);
};

// â”€â”€ TOGGLE WISHLIST â”€â”€
window.toggleWish = async function(btn, productId) {
  if (!currentUser) {
    showToast('Please log in first', 'error');
    setTimeout(() => { window.parent.postMessage({ type: 'switchTab', target: 'account' }, '*'); }, 1200);
    return;
  }

  const uid    = currentUser.uid || currentUser.id;
  const icon   = btn.querySelector('i');
  const pid    = String(productId);
  const inWish = wishlistSet.has(pid);
  // Optimistic UI first
  if (inWish) {
    wishlistSet.delete(pid);
    btn.classList.remove('active');
    if (icon) icon.className = 'far fa-heart';
  } else {
    wishlistSet.add(pid);
    btn.classList.add('active');
    if (icon) icon.className = 'fas fa-heart';
  }

  try {
    if (inWish) {
      await removeFromWishlist(uid, productId);
      showToast('Removed from wishlist');
    } else {
      const product = allProducts.find(p => String(p.id) === String(productId)) || { id: productId };
      await addToWishlist(uid, product);
      showToast('Saved to wishlist â¤ï¸', 'success');
    }
    window.parent.postMessage({ type: 'wishlistUpdate', count: wishlistSet.size }, '*');
  } catch(e) {
    // Revert on failure
    if (inWish) {
      wishlistSet.add(pid); btn.classList.add('active');
      if (icon) icon.className = 'fas fa-heart';
    } else {
      wishlistSet.delete(pid); btn.classList.remove('active');
      if (icon) icon.className = 'far fa-heart';
    }
    showToast('Something went wrong', 'error');
  }
};

// â”€â”€ OPEN PRODUCT â”€â”€
window.openProduct = function(productId) {
  var url = 'product.html?id=' + productId;
  if (window.parent && window.parent !== window) {
    window.parent.postMessage({ type: 'openProduct', url: url }, '*');
  } else {
    window.location.href = url;
  }
};

// â”€â”€ CART BADGE â”€â”€
function updateCartBadge(count) {
  const b = document.getElementById('cartBadge');
  b.textContent = count;
  b.style.display = count > 0 ? 'flex' : 'none';
}

// â”€â”€ SEARCH â”€â”€
let searchTimer;
document.getElementById('searchInput').addEventListener('input', e => {
  clearTimeout(searchTimer);
  const q = e.target.value.trim();
  searchTimer = setTimeout(async () => {
    if (q.length < 2) { loadFeatured(); return; }
    document.getElementById('featuredTitle').textContent = `"${q}"`;
    const results = allProducts.filter(p =>
      p.name.toLowerCase().includes(q.toLowerCase()) ||
      (p.category||'').toLowerCase().includes(q.toLowerCase())
    );
    renderGrid('featuredGrid', results);
  }, 350);
});

// â”€â”€ NAV BUTTONS â”€â”€
document.getElementById('cartBtn').addEventListener('click', () => {
  window.parent.postMessage({ type: 'switchTab', target: 'cart' }, '*');
});
document.getElementById('notifBtn').addEventListener('click', () => {
  window.parent.postMessage({ type: 'switchTab', target: 'account' }, '*');
});

// â”€â”€ TOAST â”€â”€
function showToast(msg, type = 'success') {
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  t.className = `toast ${type} show`;
  t.querySelector('i').className = type === 'success'
    ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
  setTimeout(() => t.classList.remove('show'), 2600);
}

init();
</script>

</body>
</html>
