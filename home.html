<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MC Store — Home</title>
<!-- FAVICON -->
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
<link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<meta name="theme-color" content="#1a56db">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --blue:      #1a56db;
  --blue-dk:   #1347c8;
  --blue-lt:   #eff6ff;
  --blue-mid:  #dbeafe;
  --gold:      #f5a623;
  --gold-lt:   #fef3c7;
  --red:       #ef4444;
  --red-lt:    #fef2f2;
  --white:     #ffffff;
  --gray:      #6b7280;
  --gray-lt:   #f9fafb;
  --text:      #0f172a;
  --border:    #e5e7eb;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'DM Sans', sans-serif;
  background: #f8fafc;
  color: var(--text);
  overflow-x: hidden;
}

.page {
  height: 100vh;
  overflow-y: auto;
  overflow-x: hidden;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/* ── TOP HEADER ── */
.top-header {
  position: sticky; top: 0; z-index: 100;
  background: var(--white);
  border-bottom: 1px solid var(--border);
  box-shadow: 0 2px 12px rgba(26,86,219,0.06);
  padding: 0 1rem;
}
.header-inner {
  max-width: 1200px; margin: 0 auto;
  height: 56px; display: flex; align-items: center; gap: 0.75rem;
}
.header-logo {
  font-family: 'Playfair Display', serif;
  font-size: 1.3rem; font-weight: 900; color: var(--text); white-space: nowrap;
}
.header-logo span { color: var(--gold); }

.search-bar {
  flex: 1; display: flex; align-items: center;
  background: var(--gray-lt); border: 1.5px solid var(--border);
  border-radius: 12px; padding: 0 0.75rem; gap: 0.5rem; height: 40px;
  transition: all 0.2s;
}
.search-bar:focus-within {
  border-color: var(--blue); background: var(--white);
  box-shadow: 0 0 0 3px rgba(26,86,219,0.08);
}
.search-bar i { color: var(--gray); font-size: 13px; }
.search-bar input {
  border: none; background: none; outline: none;
  font-family: 'DM Sans', sans-serif; font-size: 0.875rem;
  color: var(--text); width: 100%;
}
.search-bar input::placeholder { color: #9ca3af; }

.header-icons { display: flex; align-items: center; gap: 0.25rem; }
.icon-btn {
  width: 38px; height: 38px; border-radius: 10px;
  border: none; background: var(--gray-lt); color: var(--gray);
  font-size: 15px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; position: relative;
}
.icon-btn:hover { background: var(--blue-lt); color: var(--blue); }
.icon-btn .badge {
  position: absolute; top: 4px; right: 4px;
  width: 14px; height: 14px; background: var(--gold);
  border-radius: 50%; font-size: 8px; font-weight: 800;
  color: white; display: flex; align-items: center; justify-content: center;
  border: 1.5px solid white;
}

/* ── MAIN ── */
.main { max-width: 1200px; margin: 0 auto; padding: 1rem; }

/* ── WELCOME ── */
.welcome {
  margin-bottom: 1rem;
  animation: fadeUp 0.3s ease both;
}
.welcome p { font-size: 0.78rem; color: var(--gray); }
.welcome h1 {
  font-family: 'Playfair Display', serif;
  font-size: 1.15rem; font-weight: 800; color: var(--text);
}
.welcome h1 span { color: var(--blue); }

/* ── HERO BANNER ── */
.hero-wrap {
  position: relative;
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 1.25rem;
  touch-action: pan-y;
  user-select: none;
}

.hero-track {
  display: flex;
  height: 190px;
  transition: transform 0.45s cubic-bezier(0.4,0,0.2,1);
  cursor: grab;
}
.hero-track:active { cursor: grabbing; }

@media (min-width: 768px) { .hero-track { height: 270px; } }

.hero-slide {
  min-width: 100%; height: 100%;
  display: flex; align-items: center;
  padding: 1.5rem 2rem;
  position: relative; overflow: hidden;
  flex-shrink: 0;
}

/* 5 different slide gradients */
.slide-1 { background: linear-gradient(135deg, #1a56db 0%, #1e40af 100%); }
.slide-2 { background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 100%); }
.slide-3 { background: linear-gradient(135deg, #b45309 0%, #d97706 100%); }
.slide-4 { background: linear-gradient(135deg, #065f46 0%, #059669 100%); }
.slide-5 { background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); }

.slide-circle-1 {
  position: absolute; right: -20px; top: -20px;
  width: 200px; height: 200px; border-radius: 50%;
  background: rgba(255,255,255,0.08);
}
.slide-circle-2 {
  position: absolute; right: 60px; bottom: -40px;
  width: 140px; height: 140px; border-radius: 50%;
  background: rgba(255,255,255,0.05);
}
.slide-circle-3 {
  position: absolute; left: -30px; top: 50%;
  width: 100px; height: 100px; border-radius: 50%;
  background: rgba(255,255,255,0.04);
}

/* icon art on right side of slide */
.slide-art {
  position: absolute;
  right: 1.5rem; top: 50%;
  transform: translateY(-50%);
  font-size: clamp(3rem, 8vw, 5rem);
  opacity: 0.18;
  color: white;
}

.slide-content { position: relative; z-index: 2; max-width: 65%; }
.slide-tag {
  display: inline-flex; align-items: center; gap: 0.3rem;
  background: rgba(255,255,255,0.18);
  color: white; font-size: 0.68rem; font-weight: 700;
  letter-spacing: 0.06em; text-transform: uppercase;
  padding: 0.22rem 0.6rem; border-radius: 50px;
  margin-bottom: 0.45rem;
  backdrop-filter: blur(10px);
}
.slide-title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.2rem, 4vw, 1.9rem);
  font-weight: 900; color: white; line-height: 1.15;
  margin-bottom: 0.35rem;
  text-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.slide-sub {
  font-size: 0.78rem;
  color: rgba(255,255,255,0.82);
  margin-bottom: 0.8rem;
}
.slide-btn {
  display: inline-flex; align-items: center; gap: 0.4rem;
  background: white; border: none; border-radius: 50px;
  padding: 0.45rem 1rem;
  font-family: 'DM Sans', sans-serif; font-size: 0.75rem; font-weight: 700;
  cursor: pointer; transition: all 0.2s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.slide-btn:hover { transform: scale(1.04); }
.slide-1 .slide-btn { color: #1a56db; }
.slide-2 .slide-btn { color: #0f172a; }
.slide-3 .slide-btn { color: #b45309; }
.slide-4 .slide-btn { color: #065f46; }
.slide-5 .slide-btn { color: #7c3aed; }

/* left/right arrow buttons */


/* dots */
.hero-dots {
  position: absolute;
  bottom: 12px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 6px;
  z-index: 10;
  pointer-events: none;
}
.hero-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: rgba(255,255,255,0.4);
  transition: all 0.35s cubic-bezier(0.4,0,0.2,1);
  border: none;
  flex-shrink: 0;
}
.hero-dot.active {
  width: 22px;
  border-radius: 4px;
  background: white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* ── CATEGORIES ── */
.section-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 0.75rem;
}
.section-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.05rem; font-weight: 800; color: var(--text);
}
.see-all {
  font-size: 0.76rem; font-weight: 600; color: var(--blue);
  cursor: pointer; display: flex; align-items: center; gap: 3px;
}

.categories {
  display: flex; gap: 0.5rem;
  overflow-x: auto; padding-bottom: 0.5rem;
  margin-bottom: 1.25rem; scrollbar-width: none;
}
.categories::-webkit-scrollbar { display: none; }

.cat-chip {
  display: flex; flex-direction: column; align-items: center;
  gap: 0.3rem; min-width: 62px; cursor: pointer; transition: all 0.2s;
  flex-shrink: 0;
}
.cat-icon {
  width: 50px; height: 50px; border-radius: 15px;
  background: var(--white); border: 1.5px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  font-size: 18px; color: var(--gray);
  transition: all 0.3s cubic-bezier(0.175,0.885,0.32,1.275);
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.cat-label {
  font-size: 0.65rem; font-weight: 600; color: var(--gray);
  text-align: center; line-height: 1.2;
}
.cat-chip:hover .cat-icon { transform: translateY(-3px); background: var(--blue-lt); color: var(--blue); border-color: var(--blue-mid); }
.cat-chip.active .cat-icon { background: var(--blue); color: white; border-color: var(--blue); box-shadow: 0 6px 16px rgba(26,86,219,0.3); transform: translateY(-3px); }
.cat-chip.active .cat-label { color: var(--blue); font-weight: 700; }

/* ── FLASH DEALS ── */
.flash-section {
  background: linear-gradient(135deg, #fff7ed, var(--gold-lt));
  border: 1.5px solid #fcd34d; border-radius: 20px;
  padding: 1rem; margin-bottom: 1.25rem;
}
.flash-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 0.85rem;
}
.flash-title-wrap { display: flex; align-items: center; gap: 0.5rem; }
.flash-icon-box {
  width: 30px; height: 30px; background: var(--gold);
  border-radius: 9px; display: flex; align-items: center; justify-content: center;
  color: white; font-size: 14px;
  box-shadow: 0 4px 10px rgba(245,166,35,0.4);
}
.flash-title-wrap h2 {
  font-family: 'Playfair Display', serif;
  font-size: 1rem; font-weight: 800; color: #92400e;
}
.countdown { display: flex; gap: 0.25rem; align-items: center; }
.count-box {
  background: #92400e; color: white; border-radius: 6px;
  padding: 0.18rem 0.38rem; font-size: 0.72rem; font-weight: 800;
  min-width: 24px; text-align: center; font-variant-numeric: tabular-nums;
}
.count-sep { color: #92400e; font-weight: 800; font-size: 0.72rem; }

.flash-scroll {
  display: flex; gap: 0.7rem; overflow-x: auto;
  padding-bottom: 0.25rem; scrollbar-width: none;
}
.flash-scroll::-webkit-scrollbar { display: none; }

/* ── PRODUCT GRID ── */
.product-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem; margin-bottom: 1.25rem;
}
@media (min-width: 640px)  { .product-grid { grid-template-columns: repeat(3,1fr); } }
@media (min-width: 1024px) { .product-grid { grid-template-columns: repeat(4,1fr); } }

/* ── PRODUCT CARD ── */
.product-card {
  background: var(--white); border-radius: 16px;
  overflow: hidden; border: 1.5px solid var(--border);
  cursor: pointer; position: relative;
  transition: all 0.3s cubic-bezier(0.175,0.885,0.32,1.275);
  animation: fadeUp 0.4s ease both;
}
.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 28px rgba(26,86,219,0.12);
  border-color: var(--blue-mid);
}
@keyframes fadeUp {
  from { opacity:0; transform:translateY(14px); }
  to   { opacity:1; transform:translateY(0); }
}

.flash-card {
  min-width: 138px; flex-shrink: 0;
  background: var(--white); border-radius: 14px;
  overflow: hidden; border: 1.5px solid #fde68a;
  cursor: pointer; transition: all 0.25s;
}
.flash-card:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(245,166,35,0.2); }

.card-img-wrap {
  width: 100%; aspect-ratio: 1;
  background: var(--gray-lt); position: relative; overflow: hidden;
}
.flash-card .card-img-wrap { height: 118px; aspect-ratio: unset; }

.card-img-wrap img {
  width: 100%; height: 100%; object-fit: cover;
  transition: transform 0.4s ease;
}
.product-card:hover .card-img-wrap img { transform: scale(1.06); }

.card-img-placeholder {
  width: 100%; height: 100%;
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem; color: var(--blue);
  background: linear-gradient(135deg, var(--blue-lt), var(--blue-mid));
}

.discount-badge {
  position: absolute; top: 8px; left: 8px;
  background: var(--red); color: white;
  font-size: 0.63rem; font-weight: 800;
  padding: 0.18rem 0.38rem; border-radius: 6px;
}

.wishlist-btn {
  position: absolute; top: 7px; right: 7px;
  width: 27px; height: 27px; border-radius: 50%;
  background: white; border: none;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; color: #9ca3af; cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: all 0.2s;
}
.wishlist-btn:hover { color: var(--red); }
.wishlist-btn.active { color: var(--red); background: var(--red-lt); }

.card-body { padding: 0.6rem 0.7rem 0.7rem; }
.card-name {
  font-size: 0.78rem; font-weight: 600; color: var(--text);
  line-height: 1.35; margin-bottom: 0.28rem;
  display: -webkit-box; -webkit-line-clamp: 2;
  -webkit-box-orient: vertical; overflow: hidden;
}
.card-prices {
  display: flex; align-items: center; gap: 0.35rem;
  margin-bottom: 0.4rem; flex-wrap: wrap;
}
.card-price { font-size: 0.92rem; font-weight: 800; color: var(--blue); }
.card-original { font-size: 0.7rem; color: #9ca3af; text-decoration: line-through; }
.card-rating {
  display: flex; align-items: center; gap: 0.2rem;
  font-size: 0.7rem; color: var(--gray); margin-bottom: 0.45rem;
}
.card-rating i { color: var(--gold); font-size: 10px; }

.add-cart-btn {
  width: 100%; background: var(--blue); color: white;
  border: none; border-radius: 8px; padding: 0.42rem;
  font-family: 'DM Sans', sans-serif; font-size: 0.73rem; font-weight: 700;
  cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.3rem;
  transition: all 0.2s;
}
.add-cart-btn:hover { background: var(--blue-dk); }
.add-cart-btn.adding { background: #16a34a; pointer-events: none; }

/* Flash card tweaks */
.flash-card .card-body { padding: 0.45rem 0.55rem 0.55rem; }
.flash-card .card-name { font-size: 0.73rem; -webkit-line-clamp: 1; }
.flash-card .card-price { font-size: 0.82rem; }

/* ── SKELETON ── */
.skeleton {
  background: linear-gradient(90deg,#f0f0f0 25%,#e8e8e8 50%,#f0f0f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
}
@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
.skeleton-card {
  background: white; border-radius: 16px; overflow: hidden;
  border: 1.5px solid var(--border);
}
.skeleton-img { aspect-ratio: 1; width: 100%; }
.skeleton-body { padding: 0.6rem 0.7rem; }
.skeleton-line { height: 11px; margin-bottom: 7px; }
.skeleton-line.w80 { width: 80%; }
.skeleton-line.w50 { width: 50%; }
.skeleton-line.w90 { width: 90%; }

/* ── EMPTY STATE ── */
.empty-state {
  grid-column: 1/-1; text-align: center;
  padding: 2.5rem 1rem; color: var(--gray);
}
.empty-state i { font-size: 2.5rem; margin-bottom: 0.6rem; color: var(--blue-mid); display: block; }
.empty-state h3 { font-size: 0.95rem; font-weight: 700; color: var(--text); margin-bottom: 0.2rem; }
.empty-state p { font-size: 0.82rem; }

/* ── TOAST ── */
.toast {
  position: fixed; bottom: 88px; left: 50%;
  transform: translateX(-50%) translateY(16px);
  background: #0f172a; color: white;
  padding: 0.6rem 1.2rem; border-radius: 50px;
  font-size: 0.8rem; font-weight: 600;
  z-index: 9999; opacity: 0; transition: all 0.3s ease;
  white-space: nowrap; display: flex; align-items: center; gap: 0.45rem;
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  pointer-events: none;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.toast.success i { color: #4ade80; }
.toast.error i { color: #f87171; }

.pb-nav { padding-bottom: 1.5rem; }
</style>
</head>
<body>

<div class="page" id="homePage">

  <!-- TOP HEADER -->
  <header class="top-header">
    <div class="header-inner">
      <div class="header-logo">MC<span>Store</span></div>
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Search products, brands...">
      </div>
      <div class="header-icons">
        <button class="icon-btn" id="notifBtn">
          <i class="fas fa-bell"></i>
        </button>
        <button class="icon-btn" id="cartBtn">
          <i class="fas fa-cart-shopping"></i>
          <span class="badge" id="cartBadge" style="display:none">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="main">

    <!-- WELCOME -->
    <div class="welcome">
      <p>Good day <i class="fas fa-hand-wave" style="color:var(--gold)"></i></p>
      <h1>Welcome back, <span id="userName">...</span></h1>
    </div>

    <!-- ══ HERO BANNER ══ -->
    <div class="hero-wrap" id="heroWrap">

      <div class="hero-track" id="heroTrack">

        <!-- SLIDE 1 -->
        <div class="hero-slide slide-1">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-mobile-screen"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-fire"></i> Hot Deal</div>
            <div class="slide-title">Up to 50% Off<br>Electronics</div>
            <div class="slide-sub">Limited time — shop now!</div>
            <button class="slide-btn" onclick="filterCategory('Electronics & Gadgets')">
              Shop Now <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- SLIDE 2 -->
        <div class="hero-slide slide-2">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-shirt"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-star"></i> New Arrivals</div>
            <div class="slide-title">Fresh Fashion<br>Just Landed</div>
            <div class="slide-sub">Latest styles for every occasion</div>
            <button class="slide-btn" onclick="filterCategory('Fashion & Clothing')">
              Explore <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- SLIDE 3 -->
        <div class="hero-slide slide-3">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-truck-fast"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-truck"></i> Free Delivery</div>
            <div class="slide-title">Free Shipping<br>Above ₦10,000</div>
            <div class="slide-sub">Shop more, save more!</div>
            <button class="slide-btn" onclick="filterCategory(null)">
              Shop All <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- SLIDE 4 -->
        <div class="hero-slide slide-4">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-basket-shopping"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-leaf"></i> Groceries</div>
            <div class="slide-title">Fresh Food &<br>Groceries Daily</div>
            <div class="slide-sub">Quality products delivered to you</div>
            <button class="slide-btn" onclick="filterCategory('Food & Groceries')">
              Order Now <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

        <!-- SLIDE 5 -->
        <div class="hero-slide slide-5">
          <div class="slide-circle-1"></div>
          <div class="slide-circle-2"></div>
          <div class="slide-circle-3"></div>
          <div class="slide-art"><i class="fas fa-gem"></i></div>
          <div class="slide-content">
            <div class="slide-tag"><i class="fas fa-crown"></i> Premium</div>
            <div class="slide-title">Beauty & Health<br>Essentials</div>
            <div class="slide-sub">Top brands at unbeatable prices</div>
            <button class="slide-btn" onclick="filterCategory('Beauty & Health')">
              Discover <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>

      </div>

      <!-- Dots -->
      <div class="hero-dots" id="heroDots"></div>
    </div>

    <!-- ══ CATEGORIES ══ -->
    <div style="margin-bottom:1.25rem">
      <div class="section-header">
        <div class="section-title">Categories</div>
        <div class="see-all" onclick="filterCategory(null)">All <i class="fas fa-chevron-right"></i></div>
      </div>
      <div class="categories" id="catList">
        <div class="cat-chip active" data-cat="all" onclick="filterCategory(null)">
          <div class="cat-icon"><i class="fas fa-store"></i></div>
          <div class="cat-label">All</div>
        </div>
        <div class="cat-chip" data-cat="Electronics & Gadgets" onclick="filterCategory('Electronics & Gadgets')">
          <div class="cat-icon"><i class="fas fa-mobile-screen"></i></div>
          <div class="cat-label">Electronics</div>
        </div>
        <div class="cat-chip" data-cat="Fashion & Clothing" onclick="filterCategory('Fashion & Clothing')">
          <div class="cat-icon"><i class="fas fa-shirt"></i></div>
          <div class="cat-label">Fashion</div>
        </div>
        <div class="cat-chip" data-cat="Food & Groceries" onclick="filterCategory('Food & Groceries')">
          <div class="cat-icon"><i class="fas fa-basket-shopping"></i></div>
          <div class="cat-label">Groceries</div>
        </div>
        <div class="cat-chip" data-cat="Beauty & Health" onclick="filterCategory('Beauty & Health')">
          <div class="cat-icon"><i class="fas fa-pump-soap"></i></div>
          <div class="cat-label">Beauty</div>
        </div>
        <div class="cat-chip" data-cat="Home & Kitchen" onclick="filterCategory('Home & Kitchen')">
          <div class="cat-icon"><i class="fas fa-couch"></i></div>
          <div class="cat-label">Home</div>
        </div>
        <div class="cat-chip" data-cat="Sports & Fitness" onclick="filterCategory('Sports & Fitness')">
          <div class="cat-icon"><i class="fas fa-dumbbell"></i></div>
          <div class="cat-label">Sports</div>
        </div>
        <div class="cat-chip" data-cat="Books & Stationery" onclick="filterCategory('Books & Stationery')">
          <div class="cat-icon"><i class="fas fa-book-open"></i></div>
          <div class="cat-label">Books</div>
        </div>
        <div class="cat-chip" data-cat="Baby & Kids" onclick="filterCategory('Baby & Kids')">
          <div class="cat-icon"><i class="fas fa-baby"></i></div>
          <div class="cat-label">Baby</div>
        </div>
      </div>
    </div>

    <!-- ══ FEATURED PRODUCTS (right after banner) ══ -->
    <div style="margin-bottom:1.25rem">
      <div class="section-header">
        <div class="section-title" id="featuredTitle">Featured Products</div>
        <div class="see-all" onclick="filterCategory(null)">See all <i class="fas fa-chevron-right"></i></div>
      </div>
      <div class="product-grid" id="featuredGrid">
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
      </div>
    </div>

    <!-- ══ FLASH DEALS ══ -->
    <div class="flash-section" id="flashSection" style="margin-bottom:1.25rem">
      <div class="flash-header">
        <div class="flash-title-wrap">
          <div class="flash-icon-box"><i class="fas fa-bolt"></i></div>
          <h2>Flash Deals</h2>
        </div>
        <div class="countdown">
          <div class="count-box" id="countH">06</div>
          <div class="count-sep">:</div>
          <div class="count-box" id="countM">00</div>
          <div class="count-sep">:</div>
          <div class="count-box" id="countS">00</div>
        </div>
      </div>
      <div class="flash-scroll" id="flashGrid">
        <div class="flash-card" style="min-width:138px"><div class="skeleton" style="height:118px;width:100%"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="flash-card" style="min-width:138px"><div class="skeleton" style="height:118px;width:100%"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="flash-card" style="min-width:138px"><div class="skeleton" style="height:118px;width:100%"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
      </div>
    </div>

    <!-- ══ NEW ARRIVALS ══ -->
    <div style="margin-bottom:1.25rem">
      <div class="section-header">
        <div class="section-title">New Arrivals</div>
        <div class="see-all" onclick="filterCategory(null)">See all <i class="fas fa-chevron-right"></i></div>
      </div>
      <div class="product-grid" id="newArrivalsGrid">
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w90"></div><div class="skeleton skeleton-line w50"></div></div></div>
        <div class="skeleton-card"><div class="skeleton skeleton-img"></div><div class="skeleton-body"><div class="skeleton skeleton-line w80"></div><div class="skeleton skeleton-line w50"></div></div></div>
      </div>
    </div>

    <div class="pb-nav"></div>
  </main>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <i class="fas fa-check-circle"></i>
  <span id="toastMsg"></span>
</div>

<script type="module">
import { getSession } from './session.js';
import {
  getProducts, getFeaturedProducts,
  addToCart, addToWishlist, removeFromWishlist,
  getCartCount, formatPrice
} from './product.js';

// ── STATE ──
let currentUser   = null;
let allProducts   = [];
let wishlistSet   = new Set();
let heroIndex     = 0;
let heroTotal     = 5;
let heroTimer     = null;
let isDragging    = false;
let dragStartX    = 0;

// ── INIT ──
async function init() {
  const session = await getSession();
  if (session) {
    currentUser = session;
    const firstName = (session.fullName || 'Customer').split(' ')[0];
    document.getElementById('userName').textContent = firstName;
    const count = await getCartCount(session.uid).catch(() => 0);
    updateCartBadge(count);
  }

  buildHeroDots();
  startHero();
  startCountdown();

  await Promise.all([
    loadFeatured(),
    loadNewArrivals(),
    loadFlashDeals()
  ]);
}

// ── HERO DOTS ──
function buildHeroDots() {
  const wrap = document.getElementById('heroDots');
  wrap.innerHTML = Array.from({length: heroTotal}, (_, i) =>
    `<button class="hero-dot ${i===0?'active':''}" onclick="goToSlide(${i})"></button>`
  ).join('');
}

// ── HERO GO TO SLIDE ──
window.goToSlide = function(index) {
  heroIndex = (index + heroTotal) % heroTotal;
  document.getElementById('heroTrack').style.transform = `translateX(-${heroIndex * 100}%)`;
  document.querySelectorAll('.hero-dot').forEach((d, i) =>
    d.classList.toggle('active', i === heroIndex)
  );
};

// ── AUTO SLIDESHOW ──
function startHero() {
  heroTimer = setInterval(() => goToSlide(heroIndex + 1), 3000);
}
function resetHeroTimer() {
  clearInterval(heroTimer);
  startHero();
}

// ── ARROW BUTTONS ──
// ── SWIPE / DRAG on hero ──
const heroWrap = document.getElementById('heroWrap');

heroWrap.addEventListener('mousedown', e => { isDragging = true; dragStartX = e.clientX; });
heroWrap.addEventListener('mousemove', e => { if (isDragging) e.preventDefault(); });
heroWrap.addEventListener('mouseup', e => {
  if (!isDragging) return;
  isDragging = false;
  const diff = dragStartX - e.clientX;
  if (Math.abs(diff) > 40) { goToSlide(diff > 0 ? heroIndex + 1 : heroIndex - 1); resetHeroTimer(); }
});
heroWrap.addEventListener('mouseleave', () => { isDragging = false; });

heroWrap.addEventListener('touchstart', e => { dragStartX = e.touches[0].clientX; }, {passive:true});
heroWrap.addEventListener('touchend', e => {
  const diff = dragStartX - e.changedTouches[0].clientX;
  if (Math.abs(diff) > 40) { goToSlide(diff > 0 ? heroIndex + 1 : heroIndex - 1); resetHeroTimer(); }
});

// ── COUNTDOWN (6 hours) ──
function startCountdown() {
  let total = 6 * 3600;
  const tick = () => {
    document.getElementById('countH').textContent = String(Math.floor(total/3600)).padStart(2,'0');
    document.getElementById('countM').textContent = String(Math.floor((total%3600)/60)).padStart(2,'0');
    document.getElementById('countS').textContent = String(total%60).padStart(2,'0');
    if (total > 0) total--;
  };
  tick();
  setInterval(tick, 1000);
}

// ── LOAD FEATURED ──
async function loadFeatured() {
  try {
    const products = await getFeaturedProducts(8);
    allProducts = [...allProducts, ...products];
    renderGrid('featuredGrid', products);
  } catch(e) {
    renderEmpty('featuredGrid', 'No featured products yet');
  }
}

// ── LOAD NEW ARRIVALS ──
async function loadNewArrivals() {
  try {
    const products = await getProducts({ limit: 8 });
    allProducts = [...new Map([...allProducts, ...products].map(p => [p.id, p])).values()];
    renderGrid('newArrivalsGrid', products);
  } catch(e) {
    renderEmpty('newArrivalsGrid', 'No products yet');
  }
}

// ── LOAD FLASH DEALS ──
async function loadFlashDeals() {
  try {
    const products = await getProducts({ limit: 20 });
    const deals    = products.filter(p => p.discount > 0).slice(0, 8);
    if (deals.length === 0) { document.getElementById('flashSection').style.display = 'none'; return; }
    renderFlash(deals);
  } catch(e) {
    document.getElementById('flashSection').style.display = 'none';
  }
}

// ── RENDER GRID ──
function renderGrid(gridId, products) {
  const grid = document.getElementById(gridId);
  if (!products || products.length === 0) { renderEmpty(gridId, 'No products yet'); return; }
  grid.innerHTML = products.map((p, i) => productCardHTML(p, i)).join('');
}

// ── RENDER FLASH ──
function renderFlash(products) {
  document.getElementById('flashGrid').innerHTML =
    products.map((p, i) => flashCardHTML(p, i)).join('');
}

// ── RENDER EMPTY ──
function renderEmpty(gridId, msg) {
  document.getElementById(gridId).innerHTML = `
    <div class="empty-state">
      <i class="fas fa-box-open"></i>
      <h3>Coming Soon</h3>
      <p>${msg}</p>
    </div>`;
}

// ── PRODUCT CARD HTML ──
function productCardHTML(p, i) {
  const price    = formatPrice(p.price);
  const original = p.original_price > p.price ? formatPrice(p.original_price) : '';
  const rating   = p.rating ? Number(p.rating).toFixed(1) : '5.0';
  const inWish   = wishlistSet.has(p.id);
  const delay    = `animation-delay:${i * 0.055}s`;
  const catIcon  = categoryIcon(p.category);

  const imgHTML = p.image_url
    ? `<img src="${p.image_url}" alt="${p.name}" loading="lazy"
         onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">`
    : '';

  return `
  <div class="product-card" style="${delay}" onclick="openProduct('${p.id}')">
    <div class="card-img-wrap">
      ${imgHTML}
      <div class="card-img-placeholder" style="${p.image_url?'display:none':''}">
        <i class="${catIcon}" style="font-size:2.2rem"></i>
      </div>
      ${p.discount > 0 ? `<div class="discount-badge">-${p.discount}%</div>` : ''}
      <button class="wishlist-btn ${inWish?'active':''}"
        onclick="event.stopPropagation();toggleWish(this,'${p.id}')">
        <i class="fa${inWish?'s':'r'} fa-heart"></i>
      </button>
    </div>
    <div class="card-body">
      <div class="card-name">${p.name}</div>
      <div class="card-prices">
        <span class="card-price">${price}</span>
        ${original ? `<span class="card-original">${original}</span>` : ''}
      </div>
      <div class="card-rating">
        <i class="fas fa-star"></i> ${rating}
        ${p.review_count ? `<span>(${p.review_count})</span>` : ''}
      </div>
      <button class="add-cart-btn" onclick="event.stopPropagation();handleAddCart(this,'${p.id}')">
        <i class="fas fa-cart-plus"></i> Add to Cart
      </button>
    </div>
  </div>`;
}

// ── FLASH CARD HTML ──
function flashCardHTML(p, i) {
  const price    = formatPrice(p.price);
  const original = p.original_price > p.price ? formatPrice(p.original_price) : '';
  const catIcon  = categoryIcon(p.category);
  const imgHTML  = p.image_url
    ? `<img src="${p.image_url}" alt="${p.name}" loading="lazy">`
    : `<div class="card-img-placeholder"><i class="${catIcon}" style="font-size:2rem"></i></div>`;

  return `
  <div class="flash-card" onclick="openProduct('${p.id}')">
    <div class="card-img-wrap">
      ${imgHTML}
      ${p.discount>0?`<div class="discount-badge">-${p.discount}%</div>`:''}
    </div>
    <div class="card-body">
      <div class="card-name">${p.name}</div>
      <div class="card-prices">
        <span class="card-price">${price}</span>
        ${original?`<span class="card-original">${original}</span>`:''}
      </div>
    </div>
  </div>`;
}

// ── CATEGORY ICON ──
function categoryIcon(cat) {
  const map = {
    'Electronics & Gadgets': 'fas fa-mobile-screen',
    'Fashion & Clothing':    'fas fa-shirt',
    'Food & Groceries':      'fas fa-basket-shopping',
    'Beauty & Health':       'fas fa-pump-soap',
    'Home & Kitchen':        'fas fa-couch',
    'Sports & Fitness':      'fas fa-dumbbell',
    'Books & Stationery':    'fas fa-book-open',
    'Baby & Kids':           'fas fa-baby'
  };
  return map[cat] || 'fas fa-tag';
}

// ── FILTER BY CATEGORY ──
window.filterCategory = async function(cat) {
  // update chips
  document.querySelectorAll('.cat-chip').forEach(chip => {
    chip.classList.toggle('active',
      (!cat && chip.dataset.cat === 'all') || chip.dataset.cat === cat
    );
  });

  document.getElementById('featuredTitle').textContent = cat || 'All Products';

  // skeleton
  document.getElementById('featuredGrid').innerHTML = Array(4).fill(`
    <div class="skeleton-card">
      <div class="skeleton skeleton-img"></div>
      <div class="skeleton-body">
        <div class="skeleton skeleton-line w90"></div>
        <div class="skeleton skeleton-line w50"></div>
      </div>
    </div>`).join('');

  try {
    const products = cat ? await getProducts({ category: cat }) : await getFeaturedProducts(8);
    renderGrid('featuredGrid', products);
  } catch(e) {
    renderEmpty('featuredGrid', 'Could not load products.');
  }
};

// ── ADD TO CART ──
window.handleAddCart = async function(btn, productId) {
  if (!currentUser) { showToast('Please log in first', 'error'); return; }

  btn.classList.add('adding');
  btn.innerHTML = '<i class="fas fa-check"></i> Added!';

  try {
    const product = allProducts.find(p => p.id === productId) || { id: productId, name: '', price: 0 };
    await addToCart(currentUser.uid, product);
    const count = await getCartCount(currentUser.uid);
    updateCartBadge(count);
    window.parent.postMessage({ type: 'cartUpdate', count }, '*');
    showToast('Added to cart!', 'success');
  } catch(e) {
    showToast('Could not add to cart', 'error');
  }

  setTimeout(() => {
    btn.classList.remove('adding');
    btn.innerHTML = '<i class="fas fa-cart-plus"></i> Add to Cart';
  }, 2000);
};

// ── TOGGLE WISHLIST ──
window.toggleWish = async function(btn, productId) {
  if (!currentUser) { showToast('Please log in first', 'error'); return; }
  const icon   = btn.querySelector('i');
  const inWish = wishlistSet.has(productId);

  try {
    if (inWish) {
      const { removeFromWishlist } = await import('./product.js');
      await removeFromWishlist(currentUser.uid, productId);
      wishlistSet.delete(productId);
      btn.classList.remove('active');
      icon.className = 'far fa-heart';
      showToast('Removed from wishlist', 'success');
    } else {
      const product = allProducts.find(p => p.id === productId) || { id: productId };
      await addToWishlist(currentUser.uid, product);
      wishlistSet.add(productId);
      btn.classList.add('active');
      icon.className = 'fas fa-heart';
      showToast('Added to wishlist!', 'success');
    }
    window.parent.postMessage({ type: 'wishlistUpdate', count: wishlistSet.size }, '*');
  } catch(e) {
    showToast('Something went wrong', 'error');
  }
};

// ── OPEN PRODUCT ──
window.openProduct = function(productId) {
  // Product detail page — coming soon
  console.log('Product:', productId);
};

// ── CART BADGE ──
function updateCartBadge(count) {
  const b = document.getElementById('cartBadge');
  b.textContent = count;
  b.style.display = count > 0 ? 'flex' : 'none';
}

// ── SEARCH ──
let searchTimer;
document.getElementById('searchInput').addEventListener('input', e => {
  clearTimeout(searchTimer);
  const q = e.target.value.trim();
  searchTimer = setTimeout(async () => {
    if (q.length < 2) { loadFeatured(); return; }
    document.getElementById('featuredTitle').textContent = `"${q}"`;
    const results = allProducts.filter(p =>
      p.name.toLowerCase().includes(q.toLowerCase()) ||
      (p.category||'').toLowerCase().includes(q.toLowerCase())
    );
    renderGrid('featuredGrid', results);
  }, 350);
});

// ── NAV BUTTONS ──
document.getElementById('cartBtn').addEventListener('click', () => {
  window.parent.postMessage({ type: 'switchTab', target: 'cart' }, '*');
});
document.getElementById('notifBtn').addEventListener('click', () => {
  window.parent.postMessage({ type: 'switchTab', target: 'account' }, '*');
});

// ── TOAST ──
function showToast(msg, type = 'success') {
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  t.className = `toast ${type} show`;
  t.querySelector('i').className = type === 'success'
    ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
  setTimeout(() => t.classList.remove('show'), 2600);
}

init();
</script>

</body>
</html>
