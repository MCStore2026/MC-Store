<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>MC Store</title>
<!-- FAVICON -->
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
<link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<meta name="theme-color" content="#1a56db">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --blue:       #1a56db;
    --blue-dark:  #1347c8;
    --blue-light: #eff6ff;
    --blue-mid:   #dbeafe;
    --gold:       #f5a623;
    --white:      #ffffff;
    --gray:       #6b7280;
    --bg:         #f0f7ff;
    --nav-h:      68px;
    --top-h:      62px;
    --nav-bg:     rgba(255,255,255,0.97);
    --shadow:     0 -8px 32px rgba(26,86,219,0.10);
  }

  *, *::before, *::after {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    margin: 0; padding: 0;
  }

  body, html {
    width: 100%; height: 100%;
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    overflow: hidden;
  }

  /* ══════════════════════════════
     APP SHELL
  ══════════════════════════════ */
  .app-shell {
    display: flex;
    flex-direction: column;
    height: 100vh;
    width: 100%;
    position: relative;
  }

  /* ══════════════════════════════
     TOP BAR (desktop only)
  ══════════════════════════════ */
  .top-bar {
    display: none;
    height: var(--top-h);
    background: var(--white);
    border-bottom: 1px solid #e2e8f0;
    box-shadow: 0 2px 16px rgba(26,86,219,0.07);
    padding: 0 2rem;
    align-items: center;
    justify-content: space-between;
    z-index: 9999;
    flex-shrink: 0;
  }

  .top-logo {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 800;
    color: #0f172a;
    letter-spacing: -0.5px;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .top-logo span { color: var(--gold); }

  .top-nav-links {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .top-nav-item {
    display: flex;
    align-items: center;
    gap: 0.45rem;
    padding: 0.55rem 1rem;
    border-radius: 10px;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray);
    cursor: pointer;
    transition: all 0.25s ease;
    border: none;
    background: none;
    font-family: 'DM Sans', sans-serif;
    position: relative;
  }
  .top-nav-item:hover { background: var(--blue-light); color: var(--blue); }
  .top-nav-item.active { background: var(--blue-light); color: var(--blue); }
  .top-nav-item.active i { color: var(--blue); }

  /* Cart badge on desktop */
  .top-cart-wrap { position: relative; }
  .top-badge {
    position: absolute;
    top: 4px; right: 8px;
    width: 17px; height: 17px;
    background: var(--gold);
    border-radius: 50%;
    font-size: 9px;
    font-weight: 800;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid white;
  }

  .top-right {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .top-user-btn {
    width: 38px; height: 38px;
    border-radius: 50%;
    background: var(--blue-light);
    border: 2px solid var(--blue-mid);
    display: flex; align-items: center; justify-content: center;
    color: var(--blue); font-size: 16px;
    cursor: pointer; transition: all 0.25s;
  }
  .top-user-btn:hover { background: var(--blue-mid); }

  /* ══════════════════════════════
     CONTENT WINDOW
  ══════════════════════════════ */
  .content-window {
    flex: 1;
    width: 100%;
    position: relative;
    background: var(--bg);
    overflow: hidden;
  }

  /* ══════════════════════════════
     SECTIONS & IFRAMES
  ══════════════════════════════ */
  .section {
    position: absolute;
    inset: 0;
    width: 100%; height: 100%;
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .section.active {
    display: block;
    opacity: 1;
  }

  iframe {
    width: 100%; height: 100%;
    border: none; display: block;
  }

  /* ══════════════════════════════
     3D SKELETON LOADER
     Blue & gold MC Store colours
  ══════════════════════════════ */
  .skeleton-loader {
    position: absolute;
    inset: 0;
    background: var(--white);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
    gap: 1.25rem;
  }

  .loader-logo {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 800;
    color: #0f172a;
    opacity: 0.5;
    animation: loaderPulse 1.4s ease-in-out infinite;
  }
  .loader-logo span { color: var(--gold); }

  @keyframes loaderPulse {
    0%,100% { opacity: 0.4; }
    50%      { opacity: 0.9; }
  }

  .loader-3d {
    width: 48px; height: 48px;
    position: relative;
    perspective: 160px;
  }

  .loader-3d div {
    position: absolute;
    width: 100%; height: 100%;
    border: 3.5px solid transparent;
    border-radius: 50%;
    animation: loader-rotate 1.3s cubic-bezier(0.5,0,0.5,1) infinite;
  }
  .loader-3d div:nth-child(1) { border-top-color: var(--blue);      animation-delay: -0.45s; }
  .loader-3d div:nth-child(2) { border-top-color: var(--gold);      animation-delay: -0.3s; }
  .loader-3d div:nth-child(3) { border-top-color: var(--blue-dark); animation-delay: -0.15s; }
  .loader-3d div:nth-child(4) { border-top-color: #93c5fd;          animation-delay: 0s; }

  @keyframes loader-rotate {
    0%   { transform: rotateX(35deg) rotateY(-45deg) rotateZ(0deg); }
    100% { transform: rotateX(35deg) rotateY(-45deg) rotateZ(360deg); }
  }

  /* ══════════════════════════════
     BOTTOM NAV (mobile)
  ══════════════════════════════ */
  .bottom-nav {
    height: var(--nav-h);
    background: var(--nav-bg);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    display: flex;
    justify-content: space-around;
    align-items: center;
    border-top: 1px solid rgba(26,86,219,0.10);
    box-shadow: var(--shadow);
    padding: 0 8px;
    padding-bottom: env(safe-area-inset-bottom);
    z-index: 9999;
    flex-shrink: 0;
  }

  .nav-item {
    flex: 1;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    color: #94a3b8;
    transition: all 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    gap: 3px;
  }

  /* Neumorphic icon wrapper */
  .icon-wrap {
    width: 34px; height: 34px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 17px;
    border-radius: 10px;
    transition: all 0.35s cubic-bezier(0.175,0.885,0.32,1.275);
    background: #f0f7ff;
    box-shadow:
      2px 2px 6px rgba(26,86,219,0.08),
      -2px -2px 6px rgba(255,255,255,0.9),
      inset 0 0 0 rgba(0,0,0,0.03);
    position: relative;
  }

  .nav-label {
    font-size: 9px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-family: 'DM Sans', sans-serif;
  }

  /* Badge */
  .nav-badge {
    position: absolute;
    top: -4px; right: -4px;
    width: 16px; height: 16px;
    background: var(--gold);
    border-radius: 50%;
    font-size: 8px;
    font-weight: 800;
    color: white;
    display: none;
    align-items: center;
    justify-content: center;
    border: 2px solid white;
  }
  .nav-badge.show { display: flex; }

  /* Active state */
  .nav-item.active { color: var(--blue); }
  .nav-item.active .icon-wrap {
    transform: translateY(-7px) scale(1.12);
    background: var(--white);
    color: var(--blue);
    box-shadow:
      0 10px 24px rgba(26,86,219,0.22),
      0 4px 0 var(--blue),
      inset 0 -2px 6px rgba(26,86,219,0.08);
  }

  /* ══════════════════════════════
     CENTER CART BUTTON
  ══════════════════════════════ */
  .nav-item.center-cart {
    flex: 0 0 64px;
    margin-top: -28px;
  }

  .center-cart .icon-wrap {
    width: 56px; height: 56px;
    background: linear-gradient(145deg, var(--blue), var(--blue-dark));
    color: white;
    border-radius: 18px;
    font-size: 24px;
    border: 3px solid white;
    box-shadow:
      0 10px 24px rgba(26,86,219,0.40),
      0 4px 0 #0f3fa6,
      inset 0 2px 4px rgba(255,255,255,0.25);
  }

  .center-cart.active .icon-wrap {
    transform: translateY(3px);
    box-shadow:
      0 4px 10px rgba(26,86,219,0.3),
      0 1px 0 #0f3fa6,
      inset 0 2px 6px rgba(0,0,0,0.15);
  }

  .center-cart .nav-badge {
    top: -2px; right: 2px;
    width: 18px; height: 18px;
    font-size: 9px;
    border: 2.5px solid white;
  }

  /* ══════════════════════════════
     COMING SOON PLACEHOLDER
     For pages not yet built
  ══════════════════════════════ */
  .coming-soon {
    width: 100%; height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: var(--white);
    gap: 1rem;
    padding: 2rem;
    text-align: center;
  }

  .coming-soon-icon {
    width: 80px; height: 80px;
    border-radius: 24px;
    background: var(--blue-light);
    display: flex; align-items: center; justify-content: center;
    font-size: 36px;
    box-shadow: 0 8px 24px rgba(26,86,219,0.15);
    animation: iconFloat 3s ease-in-out infinite;
  }

  @keyframes iconFloat {
    0%,100% { transform: translateY(0); }
    50%      { transform: translateY(-10px); }
  }

  .coming-soon h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.4rem;
    font-weight: 800;
    color: #0f172a;
    margin-top: 0.25rem;
  }

  .coming-soon p {
    font-size: 0.875rem;
    color: var(--gray);
    max-width: 240px;
    line-height: 1.6;
  }

  .coming-soon-badge {
    background: var(--blue-light);
    color: var(--blue);
    border: 1px solid var(--blue-mid);
    border-radius: 50px;
    padding: 0.4rem 1.1rem;
    font-size: 0.78rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    margin-top: 0.25rem;
  }

  /* ══════════════════════════════
     DESKTOP — show top bar,
     hide bottom nav
  ══════════════════════════════ */
  @media (min-width: 768px) {
    .top-bar    { display: flex; }
    .bottom-nav { display: none; }
  }
</style>
</head>
<body>

<div class="app-shell" id="appShell">

  <!-- ══ TOP BAR (desktop) ══ -->
  <header class="top-bar">

    <div class="top-logo">MC<span>Store</span></div>

    <nav class="top-nav-links">
      <button class="top-nav-item active" data-target="home">
        <i class="fas fa-house"></i> Home
      </button>
      <button class="top-nav-item" data-target="wishlist">
        <i class="fas fa-heart"></i> Wishlist
      </button>
      <button class="top-nav-item top-cart-wrap" data-target="cart">
        <i class="fas fa-cart-shopping"></i> Cart
        <span class="top-badge" id="topCartBadge" style="display:none;">0</span>
      </button>
      <button class="top-nav-item" data-target="orders">
        <i class="fas fa-box"></i> Orders
      </button>
      <button class="top-nav-item" data-target="account">
        <i class="fas fa-user"></i> Account
      </button>
    </nav>

    <div class="top-right">
      <div class="top-user-btn" data-target="account" id="topUserBtn">
        <i class="fas fa-user"></i>
      </div>
    </div>

  </header>

  <!-- ══ CONTENT WINDOW ══ -->
  <main class="content-window">

    <!-- HOME -->
    <div id="home" class="section active">
      <div class="skeleton-loader">
        <div class="loader-logo">MC<span>Store</span></div>
        <div class="loader-3d"><div></div><div></div><div></div><div></div></div>
      </div>
      <iframe src="home.html" onload="this.previousElementSibling.style.display='none'" title="Home"></iframe>
    </div>

    <!-- WISHLIST -->
    <div id="wishlist" class="section">
      <div class="skeleton-loader">
        <div class="loader-logo">MC<span>Store</span></div>
        <div class="loader-3d"><div></div><div></div><div></div><div></div></div>
      </div>
      <iframe src="wishlist.html" onload="this.previousElementSibling.style.display='none'" title="Wishlist"></iframe>
    </div>

    <!-- CART -->
    <div id="cart" class="section">
      <div class="skeleton-loader">
        <div class="loader-logo">MC<span>Store</span></div>
        <div class="loader-3d"><div></div><div></div><div></div><div></div></div>
      </div>
      <iframe src="cart.html" onload="this.previousElementSibling.style.display='none'" title="Cart"></iframe>
    </div>

    <!-- ORDERS -->
    <div id="orders" class="section">
      <div class="skeleton-loader">
        <div class="loader-logo">MC<span>Store</span></div>
        <div class="loader-3d"><div></div><div></div><div></div><div></div></div>
      </div>
      <iframe src="orders.html" onload="this.previousElementSibling.style.display='none'" title="Orders"></iframe>
    </div>

    <!-- ACCOUNT -->
    <div id="account" class="section">
      <div class="skeleton-loader">
        <div class="loader-logo">MC<span>Store</span></div>
        <div class="loader-3d"><div></div><div></div><div></div><div></div></div>
      </div>
      <iframe src="account.html" onload="this.previousElementSibling.style.display='none'" title="Account"></iframe>
    </div>

  </main>

  <!-- ══ BOTTOM NAV (mobile) ══ -->
  <nav class="bottom-nav">

    <!-- HOME -->
    <div class="nav-item active" data-target="home">
      <div class="icon-wrap"><i class="fas fa-house"></i></div>
      <span class="nav-label">Home</span>
    </div>

    <!-- WISHLIST -->
    <div class="nav-item" data-target="wishlist">
      <div class="icon-wrap">
        <i class="fas fa-heart"></i>
        <span class="nav-badge" id="wishBadge">0</span>
      </div>
      <span class="nav-label">Wishlist</span>
    </div>

    <!-- CART — center raised -->
    <div class="nav-item center-cart" data-target="cart">
      <div class="icon-wrap">
        <i class="fas fa-cart-shopping"></i>
        <span class="nav-badge" id="cartBadge">0</span>
      </div>
    </div>

    <!-- ORDERS -->
    <div class="nav-item" data-target="orders">
      <div class="icon-wrap"><i class="fas fa-box"></i></div>
      <span class="nav-label">Orders</span>
    </div>

    <!-- ACCOUNT -->
    <div class="nav-item" data-target="account">
      <div class="icon-wrap"><i class="fas fa-user"></i></div>
      <span class="nav-label">Account</span>
    </div>

  </nav>

</div><!-- /app-shell -->

<script type="module">
  import { requireAuth } from './auth.js';

  // ── GUARD: must be logged in ──
  requireAuth().catch(() => {});

  // ── ALL NAV ITEMS (bottom + top) ──
  const allNavItems = document.querySelectorAll('[data-target]');
  const sections    = document.querySelectorAll('.section');

  function switchTab(target) {
    // Update all nav items
    allNavItems.forEach(el => {
      el.classList.toggle('active', el.dataset.target === target);
    });

    // Switch sections
    sections.forEach(sec => {
      sec.classList.toggle('active', sec.id === target);
    });

    // Haptic feedback on mobile
    if (window.navigator.vibrate) window.navigator.vibrate(12);

    // Save last active tab
    sessionStorage.setItem('mc_active_tab', target);
  }

  // ── ATTACH CLICK HANDLERS ──
  allNavItems.forEach(item => {
    item.addEventListener('click', () => {
      const target = item.dataset.target;
      if (target) switchTab(target);
    });
  });

  // ── RESTORE LAST TAB on reload ──
  const lastTab = sessionStorage.getItem('mc_active_tab');
  if (lastTab) switchTab(lastTab);

  // ── CART & WISHLIST BADGE SYSTEM ──
  // Other pages post messages to update badges
  // e.g. window.parent.postMessage({ type: 'cartUpdate', count: 3 }, '*')
  window.addEventListener('message', (e) => {
    if (!e.data || !e.data.type) return;

    if (e.data.type === 'cartUpdate') {
      const count = e.data.count || 0;
      const badge = document.getElementById('cartBadge');
      const topBadge = document.getElementById('topCartBadge');

      if (badge) {
        badge.textContent = count;
        badge.classList.toggle('show', count > 0);
      }
      if (topBadge) {
        topBadge.textContent = count;
        topBadge.style.display = count > 0 ? 'flex' : 'none';
      }
    }

    if (e.data.type === 'wishlistUpdate') {
      const count = e.data.count || 0;
      const badge = document.getElementById('wishBadge');
      if (badge) {
        badge.textContent = count;
        badge.classList.toggle('show', count > 0);
      }
    }

    // Child page requests tab switch
    if (e.data.type === 'switchTab') {
      switchTab(e.data.target);
    }
  });

  // ── VIEWPORT HEIGHT FIX (mobile browsers) ──
  function fixHeight() {
    document.getElementById('appShell').style.height = window.innerHeight + 'px';
  }
  window.addEventListener('resize', fixHeight);
  fixHeight();
</script>

</body>
</html>
